!function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){if(i(!function(){var e=new Error('Cannot find module "firebase"');throw e.code="MODULE_NOT_FOUND",e}()),"undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerSystem("firebase",{init:function(){var e=this.sceneEl,t=e.getAttribute("firebase"),i=this;t instanceof Object||(t=AFRAME.utils.styleParser.parse(t)),t&&(this.firebase=firebase.initializeApp(t),this.database=firebase.database(),this.broadcastingEntities={},this.entities={},firebase.database().ref("entities").once("value",function(e){i.handleInitialSync(e.val())}),firebase.database().ref("entities").on("child_added",function(e){i.handleEntityAdded(e.key,e.val())}),firebase.database().ref("entities").on("child_changed",function(e){i.handleEntityChanged(e.key,e.val())}),firebase.database().ref("entities").on("child_removed",function(e){i.handleEntityRemoved(e.key)}))},handleInitialSync:function(e){var t=this,i=this.broadcastingEntities;Object.keys(e).forEach(function(n){i[n]||t.handleEntityAdded(n,e[n])})},handleEntityAdded:function(e,t){if(!this.entities[e]&&!this.broadcastingEntities[e]){var i=document.createElement("a-entity");this.entities[e]=i;var n=t.parentId,a=this.entities[n]||this.sceneEl;delete t.parentId,Object.keys(t).forEach(function(e){"parentId"!==e&&i.setAttribute(e,t[e])}),a.appendChild(i)}},handleEntityChanged:function(e,t){if(!this.broadcastingEntities[e]){var i=this.entities[e];Object.keys(t).forEach(function(e){"parentId"!==e&&i.setAttribute(e,t[e])})}},handleEntityRemoved:function(e){var t=this.entities[e];t&&(t.parentNode.removeChild(t),delete this.entities[e])},handleExit:function(){var e=this;Object.keys(this.broadcastingEntities).forEach(function(t){delete e.broadcastingEntities[t],firebase.database().ref("entities/"+t).remove()})},registerBroadcast:function(e,t,i){var n=this.broadcastingEntities,a=this.database,s=a.ref().child("entities").push().key;e.setAttribute("firebase-broadcast","id",s),n[s]=e,a.ref().child("entities").child(s).onDisconnect().remove()},tick:function(e){if(this.firebase){var t=this.broadcastingEntities,i=this.database,n=this.sceneEl;e-this.time<10||(this.time=e,Object.keys(t).forEach(function(e){var a=t[e],s=a.getAttribute("firebase-broadcast").components,r={};if(a.parentNode!==n){var o=a.parentNode.getAttribute("firebase-broadcast");if(!o)return;r.parentId=o.id}s.forEach(function(e){r[e]=a.getComputedAttribute(e)}),i.ref("entities/"+e).update(r)}))}}}),AFRAME.registerComponent("firebase",{schema:{apiKey:{type:"string"},authDomain:{type:"string"},databaseURL:{type:"string"},storageBucket:{type:"string"}}}),AFRAME.registerComponent("firebase-broadcast",{schema:{id:{"default":""},components:{"default":["position","rotation"]}},init:function(){var e=this.el,t=e.sceneEl.systems.firebase;this.data.components.length&&t.registerBroadcast(e,this.data.components)}})}]);